# MeterGPT - æ™ºæ…§å„€å™¨è®€å€¼ç³»çµ±

[![Python](https://img.shields.io/badge/Python-3.8%2B-blue.svg)](https://www.python.org/)
[![MetaGPT](https://img.shields.io/badge/MetaGPT-0.8%2B-green.svg)](https://github.com/geekan/MetaGPT)
[![OpenCV](https://img.shields.io/badge/OpenCV-4.8%2B-red.svg)](https://opencv.org/)
[![YOLO](https://img.shields.io/badge/YOLO-v8%2B-yellow.svg)](https://ultralytics.com/)
[![PaddleOCR](https://img.shields.io/badge/PaddleOCR-2.7%2B-orange.svg)](https://github.com/PaddlePaddle/PaddleOCR)
[![License](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)

## ğŸ“– é …ç›®ç°¡ä»‹

MeterGPT æ˜¯ä¸€å€‹åŸºæ–¼ MetaGPT å¤šä»£ç†äººå”ä½œæ¶æ§‹çš„æ™ºæ…§å„€å™¨è®€å€¼ç³»çµ±ï¼Œå°ˆç‚ºè‡ªå‹•åŒ–å„€å™¨ç›£æ§å’Œè³‡æ–™æ“·å–è€Œè¨­è¨ˆã€‚ç³»çµ±æ¡ç”¨ã€ŒCode = SOP(Team)ã€çš„è¨­è¨ˆç†å¿µï¼Œå°‡ç²¾å¿ƒç·¨æ’çš„æ¨™æº–ä½œæ¥­ç¨‹åºå¯¦é«”åŒ–ï¼Œç¢ºä¿å„æ¨¡çµ„å”åŒä½œæ¥­ä»¥å¯¦ç¾å¯é ã€é›¶éºæ¼ã€é›¶èª¤æŠ„çš„å„€å™¨è®€å€¼ç›®æ¨™ã€‚

### ğŸ¯ æ ¸å¿ƒç†å¿µ

- **å¤šä»£ç†äººå”ä½œ**ï¼šåŸºæ–¼ MetaGPT æ¡†æ¶ï¼Œå°‡è¤‡é›œçš„å„€å™¨è®€å€¼ä»»å‹™åˆ†è§£ç‚ºå¤šå€‹å°ˆæ¥­ä»£ç†äºº
- **æ¨™æº–ä½œæ¥­ç¨‹åº**ï¼šå¯¦ç¾ç²¾ç¢ºçš„ SOP æµç¨‹ï¼Œç¢ºä¿è™•ç†çš„ä¸€è‡´æ€§å’Œå¯é æ€§
- **æ™ºæ…§å‚™æ´æ©Ÿåˆ¶**ï¼šå¤šå±¤æ¬¡çš„å®¹éŒ¯å’Œå‚™æ´ç­–ç•¥ï¼Œä¿è­‰ç³»çµ±é«˜å¯ç”¨æ€§
- **å¯è¿½æº¯æ€§**ï¼šå®Œæ•´çš„è™•ç†è¨˜éŒ„å’Œå½±åƒå°å­˜ï¼Œæ»¿è¶³ç¨½æ ¸éœ€æ±‚

### ğŸ¥ æ‡‰ç”¨å ´æ™¯

- **é†«ç™‚è¨­å‚™ç›£æ§**ï¼šæ‰‹è¡“å®¤ã€ICU ç­‰é—œéµç’°å¢ƒçš„å„€å™¨è®€å€¼
- **å·¥æ¥­è‡ªå‹•åŒ–**ï¼šç”Ÿç”¢ç·šä¸Šçš„å„€è¡¨ç›£æ§å’Œè³‡æ–™æ”¶é›†
- **å¯¦é©—å®¤ç®¡ç†**ï¼šç§‘ç ”è¨­å‚™çš„è‡ªå‹•åŒ–è³‡æ–™è¨˜éŒ„
- **èƒ½æºç›£æ§**ï¼šé›»åŠ›ã€æ°´å‹™ç­‰åŸºç¤è¨­æ–½çš„å„€è¡¨è®€å€¼

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ¤– å¤šä»£ç†äººå”ä½œ
- **å°ˆæ¥­åˆ†å·¥**ï¼šæ¯å€‹ä»£ç†äººå°ˆæ³¨æ–¼ç‰¹å®šä»»å‹™ï¼Œæé«˜è™•ç†æ•ˆç‡
- **æ™ºæ…§å”èª¿**ï¼šOrchestrator çµ±ä¸€ç®¡ç†ä»£ç†äººé–“çš„å”ä½œæµç¨‹
- **å‹•æ…‹èª¿åº¦**ï¼šæ ¹æ“šç³»çµ±è² è¼‰å’Œä»»å‹™å„ªå…ˆç´šå‹•æ…‹åˆ†é…è³‡æº

### ğŸ“¹ å¤šæ”å½±æ©Ÿæ”¯æ´
- **åŒæ™‚ç®¡ç†**ï¼šæ”¯æ´æœ€å¤š 8 å€‹æ”å½±æ©ŸåŒæ™‚ä¸²æµè™•ç†
- **ä¸»å‚™åˆ‡æ›**ï¼šæ™ºæ…§çš„ä¸»è¦å’Œå‚™æ´æ”å½±æ©Ÿå‹•æ…‹åˆ‡æ›æ©Ÿåˆ¶
- **PTZ æ§åˆ¶**ï¼šæ”¯æ´ Pan-Tilt-Zoom æ”å½±æ©Ÿçš„é ç¨‹æ§åˆ¶

### ğŸ” æ™ºæ…§åµæ¸¬è­˜åˆ¥
- **å¤šé¡å‹å„€å™¨**ï¼šæ”¯æ´æ•¸ä½é¡¯ç¤ºå™¨ã€ä¸ƒæ®µé¡¯ç¤ºå™¨ã€LCD è¢å¹•ã€é¡æ¯”å„€è¡¨ç­‰
- **ç²¾ç¢ºå®šä½**ï¼šä½¿ç”¨ YOLO æ¨¡å‹é€²è¡Œå„€å™¨åµæ¸¬å’Œè§’é»å®šä½
- **é€è¦–æ ¡æ­£**ï¼šè‡ªå‹•é€²è¡Œé€è¦–è®Šæ›ï¼Œç²å¾—æ¨™æº–åŒ–çš„è®€å€¼å€åŸŸ

### ğŸ›¡ï¸ å¤šå±¤å‚™æ´æ©Ÿåˆ¶
- **æ”å½±æ©Ÿå‚™æ´**ï¼šè‡ªå‹•åˆ‡æ›åˆ°å“è³ªæ›´å¥½çš„å‚™æ´æ”å½±æ©Ÿ
- **æ¼”ç®—æ³•å‚™æ´**ï¼šOCR å¤±æ•—æ™‚å•Ÿç”¨ VLM è¦–è¦ºèªè¨€æ¨¡å‹
- **äººå·¥å¯©æ ¸**ï¼šæœ€çµ‚å‚™æ´çš„äººå·¥ä»‹å…¥æ©Ÿåˆ¶

### âš¡ å³æ™‚å“è³ªè©•ä¼°
- **å¥åº·åˆ†æ•¸**ï¼šå³æ™‚è¨ˆç®—å½±åƒå“è³ªçš„ç¶œåˆå¥åº·åˆ†æ•¸
- **å¤šç¶­åº¦è©•ä¼°**ï¼šæ¸…æ™°åº¦ã€äº®åº¦ã€å°æ¯”åº¦ã€é®æ“‹æ¯”ä¾‹ç­‰å¤šé …æŒ‡æ¨™
- **è¶¨å‹¢åˆ†æ**ï¼šå“è³ªè®ŠåŒ–è¶¨å‹¢ç›£æ§å’Œé è­¦

### ğŸ”„ è‡ªå‹•å®¹éŒ¯æ¢å¾©
- **æ™ºæ…§é‡è©¦**ï¼šæ ¹æ“šå¤±æ•—é¡å‹é¸æ“‡æœ€ä½³çš„é‡è©¦ç­–ç•¥
- **å„ªé›…é™ç´š**ï¼šåœ¨éƒ¨åˆ†åŠŸèƒ½å¤±æ•ˆæ™‚ç¶­æŒæ ¸å¿ƒæœå‹™
- **è‡ªå‹•æ¢å¾©**ï¼šç³»çµ±ç•°å¸¸å¾Œçš„è‡ªå‹•æ¢å¾©æ©Ÿåˆ¶

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

### æ•´é«”æ¶æ§‹åœ–

```mermaid
graph TB
    subgraph "å¤–éƒ¨ä»‹é¢å±¤"
        API[REST API]
        WS[WebSocket]
        DB[(è³‡æ–™åº«)]
    end
    
    subgraph "æ ¸å¿ƒå”èª¿å±¤"
        ORCH[Orchestrator<br/>ç³»çµ±å”èª¿å™¨]
    end
    
    subgraph "ä»£ç†äººç”Ÿæ…‹ç³»çµ±"
        SM[StreamManager<br/>ä¸²æµç®¡ç†]
        QA[QualityAssessor<br/>å“è³ªè©•ä¼°]
        DA[DetectionAgent<br/>å„€å™¨åµæ¸¬]
        OA[OCRAgent<br/>æ–‡å­—è­˜åˆ¥]
        VA[ValidationAgent<br/>çµæœé©—è­‰]
        FA[FallbackAgent<br/>å‚™æ´è™•ç†]
    end
    
    subgraph "æ•´åˆå±¤"
        YOLO[YOLO Wrapper]
        PADDLE[PaddleOCR Wrapper]
        CV[OpenCV Utils]
        VLM[VLM APIs]
    end
    
    subgraph "ç¡¬é«”å±¤"
        CAM1[æ”å½±æ©Ÿ 1]
        CAM2[æ”å½±æ©Ÿ 2]
        CAMN[æ”å½±æ©Ÿ N]
    end
    
    API --> ORCH
    WS --> ORCH
    ORCH --> SM
    ORCH --> QA
    ORCH --> DA
    ORCH --> OA
    ORCH --> VA
    ORCH --> FA
    
    SM --> QA
    QA --> DA
    DA --> OA
    OA --> VA
    VA --> FA
    
    DA --> YOLO
    OA --> PADDLE
    SM --> CV
    FA --> VLM
    
    SM --> CAM1
    SM --> CAM2
    SM --> CAMN
    
    ORCH --> DB
```

### æ ¸å¿ƒçµ„ä»¶èªªæ˜

| çµ„ä»¶ | åŠŸèƒ½æè¿° | ä¸»è¦æŠ€è¡“ |
|------|----------|----------|
| **Orchestrator** | ç³»çµ±æ ¸å¿ƒå”èª¿å™¨ï¼Œç®¡ç†æ•´å€‹è™•ç†æµç¨‹ | MetaGPT, AsyncIO |
| **StreamManager** | ä¸²æµç®¡ç†ä»£ç†äººï¼Œè™•ç†å¤šæ”å½±æ©Ÿä¸²æµ | OpenCV, Threading |
| **QualityAssessor** | å“è³ªè©•ä¼°ä»£ç†äººï¼Œè¨ˆç®—å½±åƒå¥åº·åˆ†æ•¸ | å½±åƒè™•ç†æ¼”ç®—æ³• |
| **DetectionAgent** | åµæ¸¬ä»£ç†äººï¼ŒåŸ·è¡Œå„€å™¨å’Œè§’é»åµæ¸¬ | YOLO, æ·±åº¦å­¸ç¿’ |
| **OCRAgent** | OCRä»£ç†äººï¼ŒåŸ·è¡Œæ–‡å­—è­˜åˆ¥ | PaddleOCR, Tesseract |
| **ValidationAgent** | é©—è­‰ä»£ç†äººï¼Œé©—è­‰è­˜åˆ¥çµæœåˆç†æ€§ | è¦å‰‡å¼•æ“, çµ±è¨ˆåˆ†æ |
| **FallbackAgent** | å‚™æ´ä»£ç†äººï¼Œè™•ç†ç•°å¸¸å’Œå‚™æ´ç­–ç•¥ | VLM APIs, PTZæ§åˆ¶ |

### è™•ç†æµç¨‹

```mermaid
sequenceDiagram
    participant C as æ”å½±æ©Ÿ
    participant SM as StreamManager
    participant QA as QualityAssessor
    participant DA as DetectionAgent
    participant OA as OCRAgent
    participant VA as ValidationAgent
    participant FA as FallbackAgent
    
    C->>SM: å½±åƒä¸²æµ
    SM->>QA: å½±åƒå¹€
    QA->>QA: å“è³ªè©•ä¼°
    QA->>DA: é«˜å“è³ªå½±åƒ
    DA->>DA: å„€å™¨åµæ¸¬
    DA->>DA: è§’é»åµæ¸¬
    DA->>OA: ROI å€åŸŸ
    OA->>OA: OCR è­˜åˆ¥
    OA->>VA: è­˜åˆ¥çµæœ
    VA->>VA: çµæœé©—è­‰
    
    alt é©—è­‰é€šé
        VA->>SM: æœ€çµ‚çµæœ
    else é©—è­‰å¤±æ•—
        VA->>FA: å•Ÿå‹•å‚™æ´
        FA->>FA: å‚™æ´æ±ºç­–
        alt æ”å½±æ©Ÿåˆ‡æ›
            FA->>SM: åˆ‡æ›æ”å½±æ©Ÿ
        else VLM å‚™æ´
            FA->>FA: VLM è­˜åˆ¥
        end
    end
```

## ğŸš€ å¿«é€Ÿé–‹å§‹

### ç’°å¢ƒè¦æ±‚

- **Python**: 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬
- **ä½œæ¥­ç³»çµ±**: Linux (æ¨è–¦ Ubuntu 20.04+), Windows 10+, macOS 10.15+
- **ç¡¬é«”è¦æ±‚**:
  - CPU: 8 æ ¸å¿ƒä»¥ä¸Š
  - RAM: 16GB ä»¥ä¸Š
  - GPU: NVIDIA RTX 3060 ä»¥ä¸Š (å¯é¸ï¼Œç”¨æ–¼åŠ é€Ÿ)
  - å„²å­˜: 500GB SSD

### å®‰è£æ­¥é©Ÿ

1. **å…‹éš†å°ˆæ¡ˆ**
```bash
git clone https://github.com/your-org/meter-gpt.git
cd meter-gpt
```

2. **å»ºç«‹è™›æ“¬ç’°å¢ƒ**
```bash
python -m venv venv
source venv/bin/activate  # Linux/macOS
# æˆ–
venv\Scripts\activate     # Windows
```

3. **å®‰è£ä¾è³´å¥—ä»¶**
```bash
pip install -r requirements.txt
```

4. **ä¸‹è¼‰æ¨¡å‹æª”æ¡ˆ**
```bash
# ä¸‹è¼‰ YOLO æ¨¡å‹
mkdir -p models
wget https://github.com/ultralytics/assets/releases/download/v0.0.0/yolov8m.pt -O models/instrument_yolo.pt
wget https://github.com/ultralytics/assets/releases/download/v0.0.0/yolov8s.pt -O models/corner_yolo.pt
```

5. **é…ç½®ç³»çµ±**
```bash
cp config/meter_gpt_config.example.yaml config/meter_gpt_config.yaml
# ç·¨è¼¯é…ç½®æª”æ¡ˆä»¥ç¬¦åˆæ‚¨çš„ç’°å¢ƒ
```

### åŸºæœ¬ä½¿ç”¨ç¯„ä¾‹

#### 1. é©—è­‰é…ç½®
```bash
python main.py validate --config config/meter_gpt_config.yaml
```

#### 2. è™•ç†å–®ä¸€å½±åƒ
```bash
python main.py process --image test_images/meter.jpg --camera cam_001
```

#### 3. å•Ÿå‹•ç³»çµ±æœå‹™
```bash
python main.py run --config config/meter_gpt_config.yaml
```

#### 4. ä½¿ç”¨ Python API
```python
import asyncio
from meter_gpt.core.orchestrator import MeterGPTOrchestrator
from meter_gpt.core.config import load_config

async def main():
    # è¼‰å…¥é…ç½®
    config = load_config("config/meter_gpt_config.yaml")
    
    # åˆå§‹åŒ–ç³»çµ±
    orchestrator = await MeterGPTOrchestrator.create(config)
    
    # è™•ç†å½±åƒ
    with open("test_image.jpg", "rb") as f:
        frame_data = f.read()
    
    result = await orchestrator.process_frame("cam_001", frame_data)
    print(f"è®€å€¼çµæœ: {result.final_reading}")
    print(f"ä¿¡å¿ƒåº¦: {result.confidence}")

if __name__ == "__main__":
    asyncio.run(main())
```

## ğŸ› ï¸ æŠ€è¡“æ£§

### æ ¸å¿ƒæ¡†æ¶
- **[MetaGPT](https://github.com/geekan/MetaGPT)**: å¤šä»£ç†äººå”ä½œæ¡†æ¶
- **[AsyncIO](https://docs.python.org/3/library/asyncio.html)**: ç•°æ­¥è™•ç†å’Œä¸¦ç™¼æ§åˆ¶
- **[Pydantic](https://pydantic-docs.helpmanual.io/)**: è³‡æ–™é©—è­‰å’Œè¨­å®šç®¡ç†

### æ·±åº¦å­¸ç¿’å’Œé›»è…¦è¦–è¦º
- **[PyTorch](https://pytorch.org/)**: æ·±åº¦å­¸ç¿’æ¡†æ¶
- **[Ultralytics YOLO](https://ultralytics.com/)**: ç‰©ä»¶åµæ¸¬æ¨¡å‹
- **[OpenCV](https://opencv.org/)**: é›»è…¦è¦–è¦ºè™•ç†
- **[scikit-image](https://scikit-image.org/)**: å½±åƒè™•ç†æ¼”ç®—æ³•

### è³‡æ–™è™•ç†å’Œé©—è­‰
- **[PaddleOCR](https://github.com/PaddlePaddle/PaddleOCR)**: å…‰å­¸å­—ç¬¦è­˜åˆ¥
- **[EasyOCR](https://github.com/JaidedAI/EasyOCR)**: å‚™æ´ OCR å¼•æ“
- **[pandas](https://pandas.pydata.org/)**: è³‡æ–™è™•ç†å’Œåˆ†æ
- **[scikit-learn](https://scikit-learn.org/)**: æ©Ÿå™¨å­¸ç¿’å·¥å…·

### ç•°æ­¥è™•ç†å’Œç¶²è·¯
- **[FastAPI](https://fastapi.tiangolo.com/)**: ç¾ä»£ Web API æ¡†æ¶
- **[WebSockets](https://websockets.readthedocs.io/)**: å³æ™‚é€šè¨Š
- **[aiohttp](https://docs.aiohttp.org/)**: ç•°æ­¥ HTTP å®¢æˆ¶ç«¯/ä¼ºæœå™¨

## ğŸ“ é …ç›®çµæ§‹

```
meter_gpt/
â”œâ”€â”€ ğŸ“ meter_gpt/                 # æ ¸å¿ƒå¥—ä»¶
â”‚   â”œâ”€â”€ ğŸ“ agents/                # ä»£ç†äººæ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ stream_manager.py      # ä¸²æµç®¡ç†ä»£ç†äºº
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ quality_assessor.py    # å“è³ªè©•ä¼°ä»£ç†äºº
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ detection_agent.py     # åµæ¸¬ä»£ç†äºº
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ocr_agent.py           # OCR ä»£ç†äºº
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ validation_agent.py    # é©—è­‰ä»£ç†äºº
â”‚   â”‚   â””â”€â”€ ğŸ“„ fallback_agent.py      # å‚™æ´ä»£ç†äºº
â”‚   â”œâ”€â”€ ğŸ“ core/                  # æ ¸å¿ƒæ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ orchestrator.py        # ç³»çµ±å”èª¿å™¨
â”‚   â”‚   â””â”€â”€ ğŸ“„ config.py              # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ ğŸ“ integrations/          # ç¬¬ä¸‰æ–¹æ•´åˆ
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ yolo_wrapper.py        # YOLO æ¨¡å‹å°è£
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ paddle_ocr_wrapper.py  # PaddleOCR å°è£
â”‚   â”‚   â””â”€â”€ ğŸ“„ opencv_utils.py        # OpenCV å·¥å…·
â”‚   â”œâ”€â”€ ğŸ“ models/                # è³‡æ–™æ¨¡å‹
â”‚   â”‚   â””â”€â”€ ğŸ“„ messages.py            # è¨Šæ¯å’Œè³‡æ–™çµæ§‹
â”‚   â””â”€â”€ ğŸ“ utils/                 # å·¥å…·æ¨¡çµ„
â”‚       â””â”€â”€ ğŸ“„ logger.py              # æ—¥èªŒç®¡ç†
â”œâ”€â”€ ğŸ“ docs/                      # æ–‡æª”
â”‚   â”œâ”€â”€ ğŸ“ agents/                # ä»£ç†äººæ–‡æª”
â”‚   â”œâ”€â”€ ğŸ“ architecture/          # æ¶æ§‹æ–‡æª”
â”‚   â””â”€â”€ ğŸ“ core/                  # æ ¸å¿ƒæ¨¡çµ„æ–‡æª”
â”œâ”€â”€ ğŸ“ config/                    # é…ç½®æª”æ¡ˆ
â”œâ”€â”€ ğŸ“ models/                    # æ¨¡å‹æª”æ¡ˆ
â”œâ”€â”€ ğŸ“ tests/                     # æ¸¬è©¦æª”æ¡ˆ
â”œâ”€â”€ ğŸ“„ main.py                    # ä¸»ç¨‹å¼å…¥å£
â”œâ”€â”€ ğŸ“„ requirements.txt           # ä¾è³´å¥—ä»¶
â””â”€â”€ ğŸ“„ README.md                  # å°ˆæ¡ˆèªªæ˜
```

### æ ¸å¿ƒæ¨¡çµ„ä»‹ç´¹

#### ä»£ç†äººæ¨¡çµ„ (`meter_gpt/agents/`)
- **StreamManager**: ç®¡ç†å¤šæ”å½±æ©Ÿä¸²æµï¼Œæä¾›å½±åƒç·©è¡å’Œå“è³ªç›£æ§
- **QualityAssessor**: è©•ä¼°å½±åƒå“è³ªï¼Œè¨ˆç®—å¥åº·åˆ†æ•¸å’Œè¶¨å‹¢åˆ†æ
- **DetectionAgent**: åŸ·è¡Œå„€å™¨åµæ¸¬ã€è§’é»åµæ¸¬å’Œé€è¦–æ ¡æ­£
- **OCRAgent**: å¤šå¼•æ“ OCR è­˜åˆ¥ï¼Œæ”¯æ´å„ç¨®é¡¯ç¤ºå™¨é¡å‹
- **ValidationAgent**: çµæœé©—è­‰ï¼ŒåŸ·è¡Œå¤šé‡é©—è­‰è¦å‰‡
- **FallbackAgent**: å‚™æ´è™•ç†ï¼Œæ™ºæ…§æ±ºç­–å’Œå®¹éŒ¯æ¢å¾©

#### æ ¸å¿ƒæ¨¡çµ„ (`meter_gpt/core/`)
- **Orchestrator**: ç³»çµ±å”èª¿å™¨ï¼Œç®¡ç†ä»£ç†äººå”ä½œæµç¨‹
- **Config**: é…ç½®ç®¡ç†ï¼Œæ”¯æ´ YAML é…ç½®å’Œå‹•æ…‹æ›´æ–°

#### æ•´åˆæ¨¡çµ„ (`meter_gpt/integrations/`)
- **YOLO Wrapper**: YOLO æ¨¡å‹çš„çµ±ä¸€ä»‹é¢å’Œæœ€ä½³åŒ–
- **PaddleOCR Wrapper**: PaddleOCR çš„å°è£å’Œé…ç½®ç®¡ç†
- **OpenCV Utils**: OpenCV çš„å¸¸ç”¨å·¥å…·å’Œå½±åƒè™•ç†å‡½æ•¸

## âš™ï¸ é…ç½®èªªæ˜

### é…ç½®æª”æ¡ˆæ ¼å¼

ç³»çµ±ä½¿ç”¨ YAML æ ¼å¼çš„é…ç½®æª”æ¡ˆï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š

```yaml
# ç³»çµ±åŸºæœ¬é…ç½®
system:
  config_id: "production_v1"
  environment: "production"
  version: "1.0.0"
  log_level: "INFO"
  log_file: "logs/meter_gpt.log"
  
  processing:
    queue_size: 100
    max_concurrent_tasks: 10
    default_timeout: 30

# æ”å½±æ©Ÿé…ç½®
cameras:
  - camera_id: "cam_001"
    camera_name: "ä¸»è¦æ”å½±æ©Ÿ"
    rtsp_url: "rtsp://192.168.1.100:554/stream"
    is_primary: true
    resolution: [1920, 1080]
    fps: 30
    
  - camera_id: "cam_002"
    camera_name: "å‚™æ´æ”å½±æ©Ÿ"
    rtsp_url: "rtsp://192.168.1.101:554/stream"
    is_primary: false
    resolution: [1920, 1080]
    fps: 30

# æ¨¡å‹é…ç½®
models:
  detection_model:
    model_name: "instrument_detector"
    model_path: "./models/instrument_yolo.pt"
    model_type: "detection"
    confidence_threshold: 0.7
    device: "cuda"
    
  corner_detection_model:
    model_name: "corner_detector"
    model_path: "./models/corner_yolo.pt"
    model_type: "corner_detection"
    confidence_threshold: 0.8
    device: "cuda"

# OCR é…ç½®
ocr:
  paddle_ocr:
    language: "ch"
    use_gpu: true
    confidence_threshold: 0.7
    
  easy_ocr:
    languages: ["ch_sim", "en"]
    gpu: true
    confidence_threshold: 0.6

# é©—è­‰è¦å‰‡é…ç½®
validation:
  overall_threshold: 0.7
  rules:
    - rule_id: "numeric_format"
      enabled: true
      parameters:
        pattern: "^-?\\d+\\.?\\d*$"
        
    - rule_id: "range_check"
      enabled: true
      parameters:
        min_value: 0
        max_value: 9999

# å‚™æ´é…ç½®
fallback:
  vlm:
    enabled: true
    model_name: "gpt-4-vision-preview"
    api_key: "${OPENAI_API_KEY}"
    confidence_threshold: 0.7
    
  camera_switch:
    enabled: true
    quality_threshold: 0.4
    
  ptz_control:
    enabled: false
    adjustment_steps: 5
```

### ä¸»è¦åƒæ•¸èªªæ˜

#### ç³»çµ±åƒæ•¸
- `queue_size`: è™•ç†ä½‡åˆ—å¤§å°ï¼Œæ§åˆ¶ç³»çµ±ååé‡
- `max_concurrent_tasks`: æœ€å¤§ä¸¦ç™¼ä»»å‹™æ•¸
- `default_timeout`: é è¨­è™•ç†è¶…æ™‚æ™‚é–“

#### æ”å½±æ©Ÿåƒæ•¸
- `rtsp_url`: RTSP ä¸²æµåœ°å€
- `is_primary`: æ˜¯å¦ç‚ºä¸»è¦æ”å½±æ©Ÿ
- `resolution`: å½±åƒè§£æåº¦
- `fps`: å¹€ç‡è¨­å®š

#### æ¨¡å‹åƒæ•¸
- `confidence_threshold`: ä¿¡å¿ƒåº¦é–¾å€¼
- `device`: é‹ç®—è¨­å‚™ (cpu/cuda)
- `model_path`: æ¨¡å‹æª”æ¡ˆè·¯å¾‘

## ğŸ”Œ API æ–‡æª”

### REST API ä»‹é¢

#### è™•ç†å–®ä¸€å½±åƒ
```http
POST /api/v1/process
Content-Type: multipart/form-data

{
  "camera_id": "cam_001",
  "image": <binary_data>,
  "metadata": {
    "timestamp": "2024-01-01T12:00:00Z",
    "priority": 1
  }
}
```

**å›æ‡‰æ ¼å¼:**
```json
{
  "frame_id": "frame_12345",
  "camera_id": "cam_001",
  "status": "success",
  "final_reading": "123.45",
  "confidence": 0.92,
  "processing_time": 2.1,
  "timestamp": "2024-01-01T12:00:00Z",
  "metadata": {
    "instrument_type": "digital_display",
    "quality_score": 0.85,
    "fallback_used": false
  }
}
```

#### å–å¾—ç³»çµ±ç‹€æ…‹
```http
GET /api/v1/status
```

**å›æ‡‰æ ¼å¼:**
```json
{
  "system_status": "running",
  "active_agents": {
    "stream_manager": true,
    "quality_assessor": true,
    "detection_agent": true,
    "ocr_agent": true,
    "validation_agent": true,
    "fallback_agent": true
  },
  "active_cameras": ["cam_001", "cam_002"],
  "processing_queue_size": 5,
  "system_metrics": {
    "total_processed": 1250,
    "success_rate": 0.94,
    "average_processing_time": 2.3,
    "system_health": 0.96
  }
}
```

#### å–å¾—æ­·å²è³‡æ–™
```http
GET /api/v1/history?camera_id=cam_001&hours=24&page=1&page_size=100
```

**å›æ‡‰æ ¼å¼:**
```json
{
  "results": [
    {
      "frame_id": "frame_001",
      "camera_id": "cam_001",
      "final_reading": "123.45",
      "confidence": 0.92,
      "timestamp": "2024-01-01T12:00:00Z",
      "processing_time": 2.1,
      "instrument_type": "digital_display"
    }
  ],
  "total_count": 1440,
  "page": 1,
  "page_size": 100,
  "total_pages": 15
}
```

#### ç³»çµ±æ§åˆ¶
```http
# é‡æ–°è¼‰å…¥é…ç½®
POST /api/v1/config/reload

# æ›´æ–°ä»£ç†äººé…ç½®
PUT /api/v1/agents/{agent_name}/config
Content-Type: application/json

{
  "confidence_threshold": 0.8,
  "enabled": true
}

# æ”å½±æ©Ÿæ§åˆ¶
POST /api/v1/cameras/{camera_id}/control
Content-Type: application/json

{
  "action": "switch_primary",
  "parameters": {}
}
```

### WebSocket ä»‹é¢

#### å³æ™‚ä¸²æµè™•ç†
```javascript
const ws = new WebSocket('ws://localhost:8000/ws/stream');

// ç™¼é€è™•ç†è«‹æ±‚
ws.send(JSON.stringify({
  "action": "start_processing",
  "camera_id": "cam_001",
  "options": {
    "continuous": true,
    "interval": 5,
    "quality_threshold": 0.6
  }
}));

// æ¥æ”¶è™•ç†çµæœ
ws.onmessage = function(event) {
  const result = JSON.parse(event.data);
  console.log('è™•ç†çµæœ:', result);
  
  // è™•ç†ä¸åŒé¡å‹çš„è¨Šæ¯
  switch(result.type) {
    case 'processing_result':
      updateDisplay(result.data);
      break;
    case 'system_status':
      updateSystemStatus(result.data);
      break;
    case 'error':
      handleError(result.data);
      break;
  }
};

// åœæ­¢è™•ç†
ws.send(JSON.stringify({
  "action": "stop_processing",
  "camera_id": "cam_001"
}));
```

#### ç³»çµ±ç›£æ§
```javascript
const monitorWs = new WebSocket('ws://localhost:8000/ws/monitor');

monitorWs.onmessage = function(event) {
  const data = JSON.parse(event.data);
  
  // å³æ™‚ç³»çµ±æŒ‡æ¨™
  if (data.type === 'metrics') {
    updateMetrics(data.metrics);
  }
  
  // ä»£ç†äººç‹€æ…‹æ›´æ–°
  if (data.type === 'agent_status') {
    updateAgentStatus(data.agent, data.status);
  }
  
  // è­¦å‘Šå’ŒéŒ¯èª¤
  if (data.type === 'alert') {
    showAlert(data.level, data.message);
  }
};
```

## ğŸš€ éƒ¨ç½²æŒ‡å—

### å–®æ©Ÿéƒ¨ç½²

#### ä½¿ç”¨ Python ç›´æ¥éƒ¨ç½²
```bash
# 1. æº–å‚™ç’°å¢ƒ
git clone https://github.com/your-org/meter-gpt.git
cd meter-gpt
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# 2. é…ç½®ç³»çµ±
cp config/meter_gpt_config.example.yaml config/meter_gpt_config.yaml
# ç·¨è¼¯é…ç½®æª”æ¡ˆ

# 3. ä¸‹è¼‰æ¨¡å‹
mkdir -p models
# ä¸‹è¼‰å¿…è¦çš„æ¨¡å‹æª”æ¡ˆ

# 4. å•Ÿå‹•ç³»çµ±
python main.py run --config config/meter_gpt_config.yaml
```

#### ç¡¬é«”éœ€æ±‚
- **CPU**: Intel i7-8700K æˆ– AMD Ryzen 7 2700X ä»¥ä¸Š
- **RAM**: 16GB DDR4 ä»¥ä¸Š
- **GPU**: NVIDIA RTX 3060 ä»¥ä¸Š (å¯é¸)
- **å„²å­˜**: 500GB NVMe SSD
- **ç¶²è·¯**: Gigabit Ethernet

### åˆ†æ•£å¼éƒ¨ç½²

#### é‚Šç·£ç¯€é»é…ç½®
```yaml
# edge_config.yaml
system:
  deployment_mode: "edge"
  node_id: "edge_001"
  
agents:
  enabled:
    - stream_manager
    - quality_assessor
    - detection_agent
  
central_node:
  host: "192.168.1.10"
  port: 8000
  api_key: "${CENTRAL_API_KEY}"
```

#### ä¸­å¤®ç¯€é»é…ç½®
```yaml
# central_config.yaml
system:
  deployment_mode: "central"
  
agents:
  enabled:
    - orchestrator
    - ocr_agent
    - validation_agent
    - fallback_agent
  
edge_nodes:
  - node_id: "edge_001"
    host: "192.168.1.11"
    capabilities: ["stream", "detection"]
```

### Docker éƒ¨ç½²

#### Dockerfile
```dockerfile
FROM python:3.9-slim

# å®‰è£ç³»çµ±ä¾è³´
RUN apt-get update && apt-get install -y \
    libgl1-mesa-glx \
    libglib2.0-0 \
    libsm6 \
    libxext6 \
    libxrender-dev \
    libgomp1 \
    wget \
    && rm -rf /var/lib/apt/lists/*

# è¨­ç½®å·¥ä½œç›®éŒ„
WORKDIR /app

# è¤‡è£½ä¾è³´æª”æ¡ˆ
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# è¤‡è£½æ‡‰ç”¨ç¨‹å¼
COPY . .

# å»ºç«‹å¿…è¦ç›®éŒ„
RUN mkdir -p logs models config

# è¨­ç½®ç’°å¢ƒè®Šæ•¸
ENV PYTHONPATH=/app
ENV CUDA_VISIBLE_DEVICES=0

# æš´éœ²ç«¯å£
EXPOSE 8000

# å•Ÿå‹•å‘½ä»¤
CMD ["python", "main.py", "run", "--config", "config/meter_gpt_config.yaml"]
```

#### Docker Compose
```yaml
version: '3.8'

services:
  meter-gpt:
    build: .
    ports:
      - "8000:8000"
    volumes:
      - ./config:/app/config
      - ./models:/app/models
      - ./logs:/app/logs
      - ./data:/app/data
    environment:
      - CUDA_VISIBLE_DEVICES=0
      - OPENAI_API_KEY=${OPENAI_API_KEY}
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    restart: unless-stopped
    
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    restart: unless-stopped
    
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: meter_gpt
      POSTGRES_USER: meter_gpt
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
```

#### éƒ¨ç½²å‘½ä»¤
```bash
# 1. æº–å‚™ç’°å¢ƒè®Šæ•¸
cp .env.example .env
# ç·¨è¼¯ .env æª”æ¡ˆ

# 2. å»ºç½®å’Œå•Ÿå‹•
docker-compose up -d

# 3. æª¢æŸ¥ç‹€æ…‹
docker-compose ps
docker-compose logs meter-gpt

# 4. æ“´å±•æœå‹™
docker
```bash
# 1. æº–å‚™ç’°å¢ƒè®Šæ•¸
cp .env.example .env
# ç·¨è¼¯ .env æª”æ¡ˆ

# 2. å»ºç½®å’Œå•Ÿå‹•
docker-compose up -d

# 3. æª¢æŸ¥ç‹€æ…‹
docker-compose ps
docker-compose logs meter-gpt

# 4. æ“´å±•æœå‹™
docker-compose up -d --scale meter-gpt=3
```

### Kubernetes éƒ¨ç½²

#### éƒ¨ç½²æ¸…å–®
```yaml
# k8s/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: meter-gpt
  labels:
    app: meter-gpt
spec:
  replicas: 3
  selector:
    matchLabels:
      app: meter-gpt
  template:
    metadata:
      labels:
        app: meter-gpt
    spec:
      containers:
      - name: meter-gpt
        image: meter-gpt:latest
        ports:
        - containerPort: 8000
        env:
        - name: CUDA_VISIBLE_DEVICES
          value: "0"
        - name: OPENAI_API_KEY
          valueFrom:
            secretKeyRef:
              name: meter-gpt-secrets
              key: openai-api-key
        resources:
          requests:
            memory: "4Gi"
            cpu: "2"
            nvidia.com/gpu: 1
          limits:
            memory: "8Gi"
            cpu: "4"
            nvidia.com/gpu: 1
        volumeMounts:
        - name: config-volume
          mountPath: /app/config
        - name: models-volume
          mountPath: /app/models
      volumes:
      - name: config-volume
        configMap:
          name: meter-gpt-config
      - name: models-volume
        persistentVolumeClaim:
          claimName: models-pvc
---
apiVersion: v1
kind: Service
metadata:
  name: meter-gpt-service
spec:
  selector:
    app: meter-gpt
  ports:
  - protocol: TCP
    port: 80
    targetPort: 8000
  type: LoadBalancer
```

## ğŸ‘¨â€ğŸ’» é–‹ç™¼æŒ‡å—

### é–‹ç™¼ç’°å¢ƒè¨­ç½®

#### 1. é–‹ç™¼ä¾è³´å®‰è£
```bash
# å®‰è£é–‹ç™¼ä¾è³´
pip install -r requirements-dev.txt

# å®‰è£ pre-commit hooks
pre-commit install

# è¨­ç½® IDE é…ç½®
cp .vscode/settings.example.json .vscode/settings.json
```

#### 2. é–‹ç™¼å·¥å…·é…ç½®
```bash
# ä»£ç¢¼æ ¼å¼åŒ–
black meter_gpt/ tests/
isort meter_gpt/ tests/

# ä»£ç¢¼æª¢æŸ¥
flake8 meter_gpt/
mypy meter_gpt/

# æ¸¬è©¦åŸ·è¡Œ
pytest tests/ -v --cov=meter_gpt
```

### ä»£ç¢¼è¦ç¯„

#### Python ä»£ç¢¼é¢¨æ ¼
- éµå¾ª **PEP 8** æ¨™æº–
- ä½¿ç”¨ **Black** é€²è¡Œä»£ç¢¼æ ¼å¼åŒ–
- ä½¿ç”¨ **isort** é€²è¡Œ import æ’åº
- ä½¿ç”¨ **type hints** é€²è¡Œé¡å‹è¨»è§£

#### å‘½åè¦ç¯„
```python
# é¡åˆ¥åç¨±ï¼šPascalCase
class StreamManager:
    pass

# å‡½æ•¸å’Œè®Šæ•¸ï¼šsnake_case
def process_frame(camera_id: str) -> ProcessingResult:
    frame_data = get_frame_data()
    return result

# å¸¸æ•¸ï¼šUPPER_SNAKE_CASE
MAX_RETRY_COUNT = 3
DEFAULT_TIMEOUT = 30

# ç§æœ‰æˆå“¡ï¼šå‰ç¶´åº•ç·š
class Agent:
    def __init__(self):
        self._internal_state = {}
        self.__private_method()
```

#### æ–‡æª”å­—ä¸²è¦ç¯„
```python
def process_frame(self, camera_id: str, frame_data: bytes) -> ProcessingResult:
    """
    è™•ç†å–®ä¸€å½±åƒå¹€
    
    Args:
        camera_id: æ”å½±æ©Ÿè­˜åˆ¥ç¢¼
        frame_data: å½±åƒäºŒé€²ä½è³‡æ–™
        
    Returns:
        ProcessingResult: è™•ç†çµæœï¼ŒåŒ…å«è®€å€¼å’Œä¿¡å¿ƒåº¦
        
    Raises:
        ValueError: ç•¶ camera_id ç„¡æ•ˆæ™‚
        ProcessingError: ç•¶è™•ç†å¤±æ•—æ™‚
        
    Example:
        >>> result = agent.process_frame("cam_001", frame_data)
        >>> print(f"è®€å€¼: {result.final_reading}")
    """
```

### æ¸¬è©¦æŒ‡å—

#### å–®å…ƒæ¸¬è©¦
```python
# tests/unit/agents/test_detection_agent.py
import pytest
from unittest.mock import Mock, patch
from meter_gpt.agents.detection_agent import DetectionAgent
from meter_gpt.models.messages import DetectionResult

class TestDetectionAgent:
    @pytest.fixture
    def agent(self):
        config = Mock()
        return DetectionAgent(config)
    
    @pytest.mark.asyncio
    async def test_detect_instrument_success(self, agent):
        # æº–å‚™æ¸¬è©¦è³‡æ–™
        frame_data = b"fake_image_data"
        
        # æ¨¡æ“¬ YOLO åµæ¸¬çµæœ
        with patch.object(agent.yolo_wrapper, 'detect') as mock_detect:
            mock_detect.return_value = [
                {"class": "digital_display", "confidence": 0.9, "bbox": [100, 100, 200, 200]}
            ]
            
            # åŸ·è¡Œæ¸¬è©¦
            result = await agent.detect_instrument(frame_data)
            
            # é©—è­‰çµæœ
            assert result.success
            assert result.instrument_type == "digital_display"
            assert result.confidence >= 0.9
```

#### æ•´åˆæ¸¬è©¦
```python
# tests/integration/test_full_pipeline.py
import pytest
from meter_gpt.core.orchestrator import MeterGPTOrchestrator
from meter_gpt.core.config import load_config

class TestFullPipeline:
    @pytest.mark.asyncio
    async def test_end_to_end_processing(self):
        # è¼‰å…¥æ¸¬è©¦é…ç½®
        config = load_config("tests/fixtures/test_config.yaml")
        
        # åˆå§‹åŒ–ç³»çµ±
        orchestrator = await MeterGPTOrchestrator.create(config)
        
        # è¼‰å…¥æ¸¬è©¦å½±åƒ
        with open("tests/fixtures/test_meter.jpg", "rb") as f:
            frame_data = f.read()
        
        # åŸ·è¡Œå®Œæ•´è™•ç†æµç¨‹
        result = await orchestrator.process_frame("test_camera", frame_data)
        
        # é©—è­‰çµæœ
        assert result.status == ProcessingStatus.SUCCESS
        assert result.final_reading is not None
        assert result.confidence > 0.5
```

#### æ•ˆèƒ½æ¸¬è©¦
```python
# tests/performance/test_throughput.py
import asyncio
import time
import pytest
from meter_gpt.core.orchestrator import MeterGPTOrchestrator

class TestPerformance:
    @pytest.mark.asyncio
    async def test_processing_throughput(self):
        orchestrator = await MeterGPTOrchestrator.create(test_config)
        
        # æº–å‚™æ¸¬è©¦è³‡æ–™
        test_frames = [load_test_frame(i) for i in range(100)]
        
        # æ¸¬é‡è™•ç†æ™‚é–“
        start_time = time.time()
        
        tasks = [
            orchestrator.process_frame(f"cam_{i%4}", frame)
            for i, frame in enumerate(test_frames)
        ]
        
        results = await asyncio.gather(*tasks)
        
        end_time = time.time()
        
        # è¨ˆç®—æ•ˆèƒ½æŒ‡æ¨™
        total_time = end_time - start_time
        fps = len(test_frames) / total_time
        success_rate = sum(1 for r in results if r.status == ProcessingStatus.SUCCESS) / len(results)
        
        # é©—è­‰æ•ˆèƒ½è¦æ±‚
        assert fps >= 10  # è‡³å°‘ 10 FPS
        assert success_rate >= 0.9  # 90% æˆåŠŸç‡
```

### è²¢ç»æŒ‡å—

#### 1. é–‹ç™¼æµç¨‹
```bash
# 1. Fork å°ˆæ¡ˆä¸¦å…‹éš†
git clone https://github.com/your-username/meter-gpt.git
cd meter-gpt

# 2. å»ºç«‹åŠŸèƒ½åˆ†æ”¯
git checkout -b feature/new-agent

# 3. é–‹ç™¼å’Œæ¸¬è©¦
# ... é€²è¡Œé–‹ç™¼ ...
pytest tests/
black meter_gpt/
flake8 meter_gpt/

# 4. æäº¤è®Šæ›´
git add .
git commit -m "feat: æ–°å¢ XXX ä»£ç†äººåŠŸèƒ½"

# 5. æ¨é€ä¸¦å»ºç«‹ Pull Request
git push origin feature/new-agent
```

#### 2. Commit è¨Šæ¯è¦ç¯„
```
<type>(<scope>): <description>

[optional body]

[optional footer]
```

**é¡å‹ (type):**
- `feat`: æ–°åŠŸèƒ½
- `fix`: éŒ¯èª¤ä¿®å¾©
- `docs`: æ–‡æª”æ›´æ–°
- `style`: ä»£ç¢¼æ ¼å¼èª¿æ•´
- `refactor`: ä»£ç¢¼é‡æ§‹
- `test`: æ¸¬è©¦ç›¸é—œ
- `chore`: å»ºç½®æˆ–è¼”åŠ©å·¥å…·è®Šæ›´

**ç¯„ä¾‹:**
```
feat(agents): æ–°å¢ QualityAssessor ä»£ç†äºº

- å¯¦ä½œå½±åƒå“è³ªè©•ä¼°æ¼”ç®—æ³•
- æ”¯æ´å¤šç¶­åº¦å“è³ªæŒ‡æ¨™è¨ˆç®—
- æ–°å¢å“è³ªè¶¨å‹¢åˆ†æåŠŸèƒ½

Closes #123
```

#### 3. Pull Request æª¢æŸ¥æ¸…å–®
- [ ] ä»£ç¢¼é€šéæ‰€æœ‰æ¸¬è©¦
- [ ] æ–°åŠŸèƒ½åŒ…å«å°æ‡‰çš„æ¸¬è©¦
- [ ] æ–‡æª”å·²æ›´æ–°
- [ ] ä»£ç¢¼é¢¨æ ¼ç¬¦åˆè¦ç¯„
- [ ] Commit è¨Šæ¯æ¸…æ™°æ˜ç¢º
- [ ] ç„¡é‡å¤§æ•ˆèƒ½å½±éŸ¿

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

#### 1. ç³»çµ±å•Ÿå‹•å¤±æ•—

**å•é¡Œæè¿°**: ç³»çµ±ç„¡æ³•æ­£å¸¸å•Ÿå‹•ï¼Œå‡ºç¾æ¨¡çµ„å°å…¥éŒ¯èª¤

**å¯èƒ½åŸå› **:
- Python ç’°å¢ƒé…ç½®ä¸æ­£ç¢º
- ä¾è³´å¥—ä»¶æœªæ­£ç¢ºå®‰è£
- CUDA ç’°å¢ƒé…ç½®å•é¡Œ

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# æª¢æŸ¥ Python ç‰ˆæœ¬
python --version  # æ‡‰è©²æ˜¯ 3.8+

# æª¢æŸ¥è™›æ“¬ç’°å¢ƒ
which python
which pip

# é‡æ–°å®‰è£ä¾è³´
pip install --upgrade pip
pip install -r requirements.txt --force-reinstall

# æª¢æŸ¥ CUDA ç’°å¢ƒ
nvidia-smi
python -c "import torch; print(torch.cuda.is_available())"
```

#### 2. æ”å½±æ©Ÿé€£æ¥å¤±æ•—

**å•é¡Œæè¿°**: ç„¡æ³•é€£æ¥åˆ° RTSP æ”å½±æ©Ÿä¸²æµ

**å¯èƒ½åŸå› **:
- ç¶²è·¯é€£æ¥å•é¡Œ
- RTSP URL é…ç½®éŒ¯èª¤
- æ”å½±æ©Ÿèªè­‰å¤±æ•—

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# æ¸¬è©¦ç¶²è·¯é€£æ¥
ping 192.168.1.100

# æ¸¬è©¦ RTSP ä¸²æµ
ffmpeg -i rtsp://192.168.1.100:554/stream -t 10 -f null -

# æª¢æŸ¥æ”å½±æ©Ÿé…ç½®
curl -u admin:password http://192.168.1.100/api/status
```

**é…ç½®æª¢æŸ¥**:
```yaml
cameras:
  - camera_id: "cam_001"
    rtsp_url: "rtsp://username:password@192.168.1.100:554/stream"
    timeout: 30
    retry_count: 3
```

#### 3. æ¨¡å‹è¼‰å…¥å¤±æ•—

**å•é¡Œæè¿°**: YOLO æˆ– OCR æ¨¡å‹ç„¡æ³•æ­£ç¢ºè¼‰å…¥

**å¯èƒ½åŸå› **:
- æ¨¡å‹æª”æ¡ˆè·¯å¾‘éŒ¯èª¤
- æ¨¡å‹æª”æ¡ˆæå£
- GPU è¨˜æ†¶é«”ä¸è¶³

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# æª¢æŸ¥æ¨¡å‹æª”æ¡ˆ
ls -la models/
file models/instrument_yolo.pt

# æ¸¬è©¦æ¨¡å‹è¼‰å…¥
python -c "
from ultralytics import YOLO
model = YOLO('models/instrument_yolo.pt')
print('æ¨¡å‹è¼‰å…¥æˆåŠŸ')
"

# æª¢æŸ¥ GPU è¨˜æ†¶é«”
nvidia-smi
```

#### 4. è™•ç†æ•ˆèƒ½ä½ä¸‹

**å•é¡Œæè¿°**: ç³»çµ±è™•ç†é€Ÿåº¦éæ…¢ï¼Œç„¡æ³•é”åˆ°é æœŸ FPS

**å¯èƒ½åŸå› **:
- ç¡¬é«”è³‡æºä¸è¶³
- é…ç½®åƒæ•¸ä¸ç•¶
- æ¨¡å‹éæ–¼è¤‡é›œ

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# ç›£æ§ç³»çµ±è³‡æº
htop
nvidia-smi -l 1

# èª¿æ•´é…ç½®åƒæ•¸
# åœ¨ config.yaml ä¸­ï¼š
processing:
  max_concurrent_tasks: 4  # é™ä½ä¸¦ç™¼æ•¸
  queue_size: 50          # æ¸›å°‘ä½‡åˆ—å¤§å°

models:
  detection_model:
    device: "cpu"          # ä½¿ç”¨ CPU è™•ç†
    confidence_threshold: 0.8  # æé«˜é–¾å€¼
```

#### 5. OCR è­˜åˆ¥æº–ç¢ºç‡ä½

**å•é¡Œæè¿°**: OCR è­˜åˆ¥çµæœä¸æº–ç¢ºæˆ–ä¿¡å¿ƒåº¦éä½

**å¯èƒ½åŸå› **:
- å½±åƒå“è³ªä¸ä½³
- OCR å¼•æ“é…ç½®ä¸ç•¶
- å„€å™¨é¡å‹ä¸åŒ¹é…

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# å•Ÿç”¨é™¤éŒ¯æ¨¡å¼
export METER_GPT_DEBUG=1
python main.py process --image test.jpg --camera test

# æª¢æŸ¥å½±åƒå“è³ª
python -c "
from meter_gpt.agents.quality_assessor import QualityAssessor
assessor = QualityAssessor()
score = assessor.assess_quality(image)
print(f'å“è³ªåˆ†æ•¸: {score}')
"
```

**é…ç½®èª¿æ•´**:
```yaml
ocr:
  paddle_ocr:
    confidence_threshold: 0.5  # é™ä½é–¾å€¼
    use_gpu: true
    det_db_thresh: 0.3
    det_db_box_thresh: 0.5
    
validation:
  rules:
    - rule_id: "confidence_check"
      parameters:
        min_confidence: 0.6  # èª¿æ•´æœ€å°ä¿¡å¿ƒåº¦
```

### é™¤éŒ¯å·¥å…·

#### 1. æ—¥èªŒåˆ†æ
```bash
# å³æ™‚æŸ¥çœ‹æ—¥èªŒ
tail -f logs/meter_gpt.log

# æœå°‹éŒ¯èª¤
grep "ERROR" logs/meter_gpt.log

# åˆ†æç‰¹å®šä»£ç†äººæ—¥èªŒ
grep "DetectionAgent" logs/meter_gpt.log | tail -20
```

#### 2. æ•ˆèƒ½åˆ†æ
```bash
# å•Ÿç”¨æ•ˆèƒ½åˆ†æ
export METER_GPT_PROFILE=1
python main.py run --config config.yaml

# åˆ†ææ•ˆèƒ½å ±å‘Š
python -m cProfile -o profile.stats main.py process --image test.jpg
python -c "
import pstats
p = pstats.Stats('profile.stats')
p.sort_stats('cumulative').print_stats(20)
"
```

#### 3. è¦–è¦ºåŒ–é™¤éŒ¯
```python
# å•Ÿç”¨è¦–è¦ºåŒ–é™¤éŒ¯æ¨¡å¼
from meter_gpt.utils.debug import enable_visual_debug

enable_visual_debug(
    save_intermediate=True,
    output_dir="debug_output/",
    show_bboxes=True,
    show_roi=True
)
```

### ç›£æ§å’Œè­¦å ±

#### 1. ç³»çµ±ç›£æ§
```bash
# æª¢æŸ¥ç³»çµ±ç‹€æ…‹
curl -s http://localhost:8000/api/v1/status | jq .

# ç›£æ§è™•ç†ä½‡åˆ—
watch -n 1 'curl -s http://localhost:8000/api/v1/metrics | jq .processing_queue_size'

# æª¢æŸ¥ä»£ç†äººå¥åº·ç‹€æ…‹
curl -s http://localhost:8000/api/v1/agents/status | jq .
```

#### 2. è­¦å ±è¨­ç½®
```yaml
# config/alerts.yaml
alerts:
  processing_queue_size:
    threshold: 50
    action: "email"
    recipients: ["admin@company.com"]
    
  success_rate:
    threshold: 0.8
    window: "5m"
    action: "webhook"
    url: "https://hooks.slack.com/..."
    
  agent_failure:
    threshold: 3
    window: "1m"
    action: "restart_agent"
```

## ğŸ“„ æˆæ¬Šå’Œè‡´è¬

### æˆæ¬Šæ¢æ¬¾

æœ¬å°ˆæ¡ˆæ¡ç”¨ [MIT License](LICENSE) æˆæ¬Šæ¢æ¬¾ã€‚

```
MIT License

Copyright (c) 2025 MeterGPT

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
```

### æŠ€è¡“è‡´è¬

æˆ‘å€‘æ„Ÿè¬ä»¥ä¸‹é–‹æºå°ˆæ¡ˆå’ŒæŠ€è¡“ç¤¾ç¾¤çš„è²¢ç»ï¼š

#### æ ¸å¿ƒæ¡†æ¶
- **[MetaGPT](https://github.com/geekan/MetaGPT)** - å¤šä»£ç†äººå”ä½œæ¡†æ¶
- **[PyTorch](https://pytorch.org/)** - æ·±åº¦å­¸ç¿’æ¡†æ¶
- **[OpenCV](https://opencv.org/)** - é›»è…¦è¦–è¦ºè™•ç†åº«

#### æ·±åº¦å­¸ç¿’æ¨¡å‹
- **[Ultralytics YOLO](https://ultralytics.com/)** - ç‰©ä»¶åµæ¸¬æ¨¡å‹
- **[PaddleOCR](https://github.com/PaddlePaddle/PaddleOCR)** - å…‰å­¸å­—ç¬¦è­˜åˆ¥
- **[EasyOCR](https://github.com/JaidedAI/EasyOCR)** - å¤šèªè¨€ OCR å¼•æ“

#### é–‹ç™¼å·¥å…·
- **[FastAPI](https://fastapi.tiangolo.com/)** - ç¾ä»£ Web API æ¡†æ¶
- **[Pydantic](https://pydantic-docs.helpmanual.io/)** - è³‡æ–™é©—è­‰å’Œè¨­å®šç®¡ç†
- **[pytest](https://pytest.org/)** - Python æ¸¬è©¦æ¡†æ¶

#### ç‰¹åˆ¥æ„Ÿè¬
- **é†«ç™‚è¨­å‚™è£½é€ å•†** - æä¾›å„€å™¨è¦æ ¼å’Œæ¸¬è©¦è³‡æ–™
- **é–‹æºç¤¾ç¾¤** - æŒçºŒçš„æŠ€è¡“æ”¯æ´å’Œå›é¥‹
- **ç ”ç©¶æ©Ÿæ§‹** - æ¼”ç®—æ³•ç ”ç©¶å’Œæœ€ä½³åŒ–å»ºè­°

### è²¢ç»è€…

æ„Ÿè¬æ‰€æœ‰ç‚º MeterGPT å°ˆæ¡ˆåšå‡ºè²¢ç»çš„é–‹ç™¼è€…å’Œç ”ç©¶äººå“¡ã€‚

### è¯çµ¡è³‡è¨Š

- **å°ˆæ¡ˆé¦–é **: https://github.com/your-org/meter-gpt
- **å•é¡Œå›å ±**: https://github.com/your-org/meter-gpt/issues
- **æŠ€è¡“è¨è«–**: https://github.com/your-org/meter-gpt/discussions
- **é›»å­éƒµä»¶**: meter-gpt@your-org.com

### å¼•ç”¨

å¦‚æœæ‚¨åœ¨ç ”ç©¶æˆ–å°ˆæ¡ˆä¸­ä½¿ç”¨äº† MeterGPTï¼Œè«‹å¼•ç”¨ï¼š

```bibtex
@software{meter_gpt_2025,
  title={MeterGPT: Intelligent Instrument Reading System with Multi-Agent Collaboration},
  author={MeterGPT Team},
  year={2025},
  url={https://github.com/your-org/meter-gpt},
  version={1.0.0}
}
```

---

<div align="center">

**ğŸš€ è®“æ™ºæ…§å„€å™¨è®€å€¼è®Šå¾—ç°¡å–®å¯é  ğŸš€**

[é–‹å§‹ä½¿ç”¨](#å¿«é€Ÿé–‹å§‹) â€¢ [æŸ¥çœ‹æ–‡æª”](docs/) â€¢ [å›å ±å•é¡Œ](https://github.com/your-org/meter-gpt/issues) â€¢ [åƒèˆ‡è²¢ç»](#è²¢ç»æŒ‡å—)

</div>